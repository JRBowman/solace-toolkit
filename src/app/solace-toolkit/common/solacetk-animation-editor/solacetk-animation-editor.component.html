<solacetk-panel [panelName]="panelName" panelIcon="animation" [panelColor]="bgColor" panelType="panel">

    <!-- <mat-card class="mat-elevation-z0 auto-flex" [style.backgroundColor]="bgColor">
        <mat-card-content> -->

    <mat-divider class="mb-2 mt-2"></mat-divider>

    <div class="panel-content">
        <div class="disp-flex mb-2" *ngIf="model">

            <!-- Frame List -->
            <div *ngIf="showFrames" class="no-flex width-8">
                <h3>Frames</h3>
                <mat-chip-list class="no-flex">
                    <mat-chip class="min-width-12 width-4 justify-center font-small" *ngFor="let frame of frames"
                        (click)="onSelect(frame)"
                        [style.background-color]="selectedFrame == frame ? 'mediumvioletred' : 'cadetblue'">
                        {{frame.name}}
                    </mat-chip>
                </mat-chip-list>
            </div>

            <div class="no-flex gap-1"></div>

            <!-- Sprite Animation Preview -->
            <div class="auto-flex width-2">

                <div class="disp-flex align-center relative-container">
                    <div class="sprite no-flex sprite-frame" [style.width]="spriteWidth + 'px'">
                        <img [class]="aseReady ? 'sprite-thumb-2col sprite align-center component-collider' : 'sprite-thumb-2col sprite-placeholder align-center component-collider'"
                            [src]="sheetName" [style.backgroundColor]="bgColor" alt="sprite"
                            [style.left]="(selected * -(spriteWidth)) + 'px'" [style.height]="spriteHeight + 'px'">
                    </div>
                    <div *ngIf="model.components && model.components.length > 0">
                        <div class="component-visual" *ngFor="let component of model.components" cdkDrag
                            [matTooltip]="component.name" [style.backgroundColor]="component.color"
                            [style.left]="(component.positionX * 96) + 'px'"
                            [style.bottom]="(component.positionY * 96) + 'px'"
                            [style.width]="(component.scaleX * spriteWidth) + 'px'"
                            [style.height]="(component.scaleY * spriteWidth) + 'px'">
                        </div>
                    </div>
                </div>

                <mat-divider></mat-divider>
                <div class="disp-flex no-flex mt-2">

                    <button *ngIf="!isPlaying" mat-icon-button color="primary" class="no-flex"
                        (click)="playAnimation()">
                        <mat-icon>play_arrow</mat-icon>
                    </button>
                    <button *ngIf="isPlaying" mat-icon-button color="primary" class="no-flex" (click)="stopAnimation()">
                        <mat-icon>stop</mat-icon>
                    </button>

                    <mat-divider [vertical]="true" class="mr-2 ml-2"></mat-divider>

                    <div *ngIf="showFrames && aseReady" class="disp-flex no-flex">
                        <!-- <h4>Frame: {{selectedFrame.name}}</h4> -->
                        <mat-form-field class="no-flex width-6 mr-2">
                            <mat-label>Duration</mat-label>
                            <input type="number" matInput [(ngModel)]="model.frames[selected].duration"
                                placeholder="100">
                            <span matSuffix>ms</span>
                        </mat-form-field>

                        <mat-divider [vertical]="true" class="mr-2 ml-2"></mat-divider>

                        <mat-form-field class="no-flex width-6 mr-2">
                            <mat-label>Sprite Width</mat-label>
                            <input type="number" matInput [(ngModel)]="spriteWidth" placeholder="192">
                            <span matSuffix>px</span>
                        </mat-form-field>

                        <mat-form-field class="no-flex width-6 mr-2">
                            <mat-label>Sprite Height</mat-label>
                            <input type="number" matInput [(ngModel)]="spriteHeight" placeholder="192">
                            <span matSuffix>px</span>
                        </mat-form-field>

                        <mat-form-field class="no-flex width-6 mr-2">
                            <mat-label>Zoom Scale</mat-label>
                            <input type="number" matInput [(ngModel)]="zoomFactor" placeholder="4">
                            <span matSuffix>x</span>
                        </mat-form-field>

                        <mat-divider [vertical]="true" class="no-flex mr-2 ml-2"></mat-divider>
                    </div>



                    <!-- <div class="auto-flex"></div> -->

                    <button mat-icon-button matTooltip="Sync Component State" color="primary" class="no-flex"
                        (click)="addComponentToFrame()">
                        <mat-icon>sync_alt</mat-icon>
                    </button>

                </div>
                <mat-divider class="mb-2"></mat-divider>

                <div class="disp-flex auto-flex" *ngIf="model && showFrames && aseReady">
                    <!-- Visual Frame Data -->
                    <div class="auto-flex">
                        <solacetk-attributes-panel [panelMode]="1" [panelName]="'Frame ' + selected + ' Data'"
                            panelType="expansionpanel" [(model)]="model.frames[selected].downstreamData">
                        </solacetk-attributes-panel>
                    </div>
                </div>

            </div>

            <div class="no-flex gap-1"></div>

            <!-- Visual Component Data -->
            <!-- <div *ngIf="showFrames && aseReady" class="no-flex width-5">
                <solacetk-controller-component [(model)]="model.components" [(selectedComponent)]="selectedComponent"
                    panelColor="darkslategrey">
                </solacetk-controller-component>
            </div> -->


        </div>

    </div>

    <!-- <mat-divider class="mb-2 mt-2"></mat-divider> -->

    <!-- </mat-card-content> -->

    <!-- <mat-card-actions class="pos-bottom mt-2"> -->
    <div class="panel-actions">
        <div *ngIf="showDataPanel">
            <button mat-button color="primary" (click)="aseUpload.click()">Import Aseprite</button>
            <button mat-button color="primary" (click)="sheetUpload.click()">Import Sprite
                Sheet</button>
            <button mat-button color="primary" (click)="textureUpload.click()">Add Frame</button>
            <button mat-button (click)="loadDefaultComponents()">Add Default Components</button>
            <button mat-button (click)="addComponent()">Add Component</button>
            <button mat-button color="primary" (click)="logModel()">Log Model</button>
            <input type="file" class="file-input" (change)="onAseSelected($event)" accept=".ase,.aseprite" #aseUpload>
            <input type="file" class="file-input" (change)="onSheetSelected($event)" accept=".png" #sheetUpload>
            <input type="file" class="file-input" (change)="onTextureSelected($event)" accept=".png" #textureUpload>


        </div>
    </div>
    <!-- </mat-card-actions> -->

    <!-- </mat-card> -->

    <mat-divider class="mb-2 mt-2"></mat-divider>

    <div *ngIf="showDataPanel && model" class="disp-flex">
        <mat-form-field class="model-formfield no-flex">
            <input matInput #speed placeholder="Playback Speed" [(ngModel)]="model.speed">
        </mat-form-field>
        <mat-checkbox name="loop" class="auto-flex model-formfield align-center" [(ngModel)]="model.loop">Loop
        </mat-checkbox>
        <mat-checkbox name="invert" class="auto-flex model-formfield align-center" [(ngModel)]="model.invert">Invert
        </mat-checkbox>
        <mat-checkbox name="mirror" class="auto-flex align-center" [(ngModel)]="model.mirror">Mirror
        </mat-checkbox>
    </div>

</solacetk-panel>